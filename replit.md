# تطبيق معهد القاسم للعلوم واللغات

## Overview
تطبيق ويب شامل لإدارة معهد تعليمي باللغة العربية، مبني باستخدام Flask وPython وقاعدة بيانات SQLite. يوفر نظامًا متكاملًا لإدارة المستخدمين، الدورات التدريبية، الأخبار، والدروس، مع نظام مصادقة متعدد الأدوار (مدير، معاون، مدرس، طالب) ونظام نسخ احتياطي متقدم يدعم التكامل مع Telegram. يهدف المشروع إلى توفير حل شامل لإدارة العمليات التعليمية والإدارية للمعهد، مع التركيز على الأمان وسهولة الاستخدام.

## User Preferences
- جميع الاتصالات باللغة العربية
- شرح واضح ومختصر
- الإبلاغ عن التغييرات المهمة قبل تنفيذها
- إعطاء الأولوية للأمان وسلامة البيانات
- عدم استخدام بيانات ثابتة في الكود

## System Architecture

### التقنيات المستخدمة
-   **الواجهة الخلفية**: Flask (Python 3.11)
-   **قاعدة البيانات**: SQLite
-   **المصادقة**: Flask-Login مع تسجيل دخول برقم الجوال وتشفير كلمات المرور (Werkzeug)
-   **النماذج**: Flask-WTF مع حماية CSRF
-   **إدارة الملفات**: رفع الصور والملفات بحد أقصى 16 MB
-   **النسخ الاحتياطي**: خيارات متعددة (شامل، بنية، بيانات) مع إرسال تلقائي للتيليجرام، وتوليد نسخ احتياطية تلقائية عند تغيير قاعدة البيانات باستخدام SQLAlchemy Event Listeners ومعالجة خلفية (threading).
-   **التكامل مع التيليجرام**: إدارة كاملة من لوحة التحكم لإشعارات النسخ الاحتياطي واستمارة "اتصل بنا"، بالإضافة إلى بوت تيليجرام تفاعلي للمستخدمين.
-   **التوقيت**: استخدام توقيت دمشق (+3 ساعات) عبر دالة مساعدة مركزية.

### الميزات الرئيسية
-   **إدارة المستخدمين والأدوار**: إضافة، تعديل، حذف، تفعيل/تعطيل المستخدمين مع صلاحيات متقدمة لأربعة أدوار.
-   **إدارة الطلاب والأساتذة**: عرض، تعديل، حذف الطلاب والأساتذة، تسجيل الطلاب في دورات، وربطهم بأساتذة، مع تحديد الصف والشعبة لكل طالب.
-   **إدارة الصفوف والشعب**: نظام متكامل لإدارة الصفوف الدراسية والشعب المرتبطة بها، مع إمكانية تحديد الحد الأقصى للطلاب في كل شعبة.
-   **إدارة الدورات الاحترافية**: إضافة، تعديل، حذف الدورات مع رفع الصور، تحديد تاريخ البداية والنهاية، العدد الأقصى للطلاب، وعرض العدد المسجل والمقاعد المتاحة. يتم التحقق من سعة الدورات لمنع التسجيل الزائد.
-   **إدارة الدروس**: إضافة، تعديل، حذف الدروس، تحديد الدورة والأستاذ، ورفع الملفات. الدروس متاحة فقط للطلاب المسجلين، مع واجهة خاصة للمدرسين لإدارة دروسهم.
-   **نظام العلامات المتقدم**: المدرسون يديرون علامات طلابهم، والمدراء والمعاونون لديهم إدارة كاملة لجميع علامات الطلاب.
-   **نظام الإشعارات الاحترافي**: نظام متكامل للإشعارات يدعم:
    - إرسال إشعارات عبر Telegram والموقع معاً
    - إرسال جماعي لجميع المستخدمين أو حسب الدور (طلاب/مدرسين)
    - إرسال فردي لمستخدمين محددين
    - إشعارات تلقائية عند إضافة دروس جديدة للطلاب المسجلين
    - إشعارات تلقائية عند إضافة أو تحديث العلامات للطالب المعني
    - تتبع حالة القراءة والتسليم لكل إشعار
    - إحصائيات شاملة (معدل القراءة، التسليم عبر Telegram/الموقع)
    - واجهة إدارية كاملة لإدارة وعرض الإشعارات
    - عرض الإشعارات في بوت Telegram مع زر خاص وتتبع القراءة
    - **نافذة منبثقة للإشعارات الجديدة**: نافذة تلقائية تظهر للمستخدمين (طلاب ومعلمين) عند وجود إشعارات غير مقروءة مع:
      - فحص دوري تلقائي كل 30 ثانية للإشعارات الجديدة
      - عرض الإشعارات في نافذة منبثقة جذابة مع صوت تنبيه
      - إمكانية تحديد الإشعار كمقروء مباشرة من النافذة المنبثقة
      - تحديث تلقائي لشارة العدد في شريط التنقل
      - حماية كاملة من القيم الفارغة ومعالجة الأخطاء
      - API endpoints آمنة بتنسيق JSON للحصول على الإشعارات وتحديثها
-   **استمارة اتصل بنا**: مع إرسال تلقائي للتيليجرام.
-   **نظام النسخ الاحتياطي**: عرض، تحميل، استعادة النسخ الاحتياطية من لوحة الإدارة، مع نظام نسخ احتياطي تلقائي ذكي يرسل النسخ إلى تيليجرام عند التعديل على الجداول الحيوية.
-   **إدارة الرسائل الواردة**: صفحة لعرض رسائل "اتصل بنا" وإدارتها.
-   **إدارة الصور**: إمكانية حذف صور الدورات والمدرسين والطلاب من صفحات التعديل.
-   **تحسينات واجهة المستخدم**: سلايدرات Bootstrap Carousel محسّنة للمدرسين والدورات في الصفحة الرئيسية تعرض الصور الفعلية، مع عرض معلومات إضافية (سنوات الخبرة، المقاعد المتاحة).
-   **الأمان**: إزالة البيانات الثابتة، عدم وجود مستخدمين افتراضيين، تحسين أمان مسارات الملفات، فحص صلاحيات دقيق.
-   **بوت تيليجرام متكامل**: بوت احترافي للمستخدمين (طلاب، مدرسين، إدارة) يوفر تسجيل دخول، عرض دورات ودروس ودرجات وأخبار، مع لوحة تحكم مخصصة لكل دور وإشعارات تلقائية. يتم تشغيله تلقائيًا من لوحة الإدارة.

### هيكل المشروع
يتكون المشروع من مجلد `app/` الذي يحتوي على النماذج (models)، المسارات (routes) للمصادقة، الإدارة، المدرسين، الطلاب، والصفحات العامة، بالإضافة إلى القوالب (templates)، الملفات الثابتة (static)، والأدوات المساعدة (utils). الملفات الرئيسية تشمل `main.py` و`config.py` وقاعدة البيانات `alqasim_institute.db`.

## External Dependencies
-   **Telegram Bot API**: للتكامل مع Telegram لإرسال إشعارات النسخ الاحتياطي التلقائية، استلام رسائل "اتصل بنا"، وتشغيل بوت التيليجرام التفاعلي للمستخدمين. يتم إعداد Bot Token و Chat ID من لوحة التحكم الإدارية.