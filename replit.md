# تطبيق معهد القاسم للعلوم واللغات

## Overview
تطبيق ويب شامل لإدارة معهد تعليمي باللغة العربية، مبني باستخدام Flask وPython وقاعدة بيانات SQLite. يوفر نظامًا متكاملًا لإدارة المستخدمين، الدورات التدريبية، الأخبار، والدروس، مع نظام مصادقة متعدد الأدوار (مدير، معاون، مدرس، طالب) ونظام نسخ احتياطي متقدم يدعم التكامل مع Telegram. يهدف المشروع إلى توفير حل شامل لإدارة العمليات التعليمية والإدارية للمعهد.

## User Preferences
- جميع الاتصالات باللغة العربية
- شرح واضح ومختصر
- الإبلاغ عن التغييرات المهمة قبل تنفيذها
- إعطاء الأولوية للأمان وسلامة البيانات
- عدم استخدام بيانات ثابتة في الكود

## System Architecture

### التقنيات المستخدمة
- **الواجهة الخلفية**: Flask (Python 3.11)
- **قاعدة البيانات**: SQLite
- **المصادقة**: Flask-Login مع تسجيل دخول برقم الجوال وتشفير كلمات المرور (Werkzeug)
- **النماذج**: Flask-WTF مع حماية CSRF
- **إدارة الملفات**: رفع الصور والملفات بحد أقصى 16 MB
- **النسخ الاحتياطي**: خيارات متعددة (شامل، بنية، بيانات) مع إرسال تلقائي للتيليجرام، وتوليد نسخ احتياطية تلقائية عند تغيير قاعدة البيانات باستخدام SQLAlchemy Event Listeners ومعالجة خلفية (threading).
- **التكامل مع التيليجرام**: إدارة كاملة من لوحة التحكم لإشعارات النسخ الاحتياطي واستمارة "اتصل بنا".
- **التوقيت**: استخدام توقيت دمشق (+3 ساعات) عبر دالة مساعدة مركزية.

### الميزات الرئيسية
- **إدارة المستخدمين والأدوار**: إضافة، تعديل، حذف، تفعيل/تعطيل المستخدمين مع صلاحيات متقدمة لأربعة أدوار.
- **إدارة الطلاب**: عرض، تعديل، حذف الطلاب، تسجيلهم في دورات، وربطهم بأساتذة، مع تحديد الصف والشعبة لكل طالب.
- **إدارة الصفوف والشعب**: نظام متكامل لإدارة الصفوف الدراسية والشعب المرتبطة بها، مع إمكانية تحديد الحد الأقصى للطلاب في كل شعبة.
- **إدارة المدرسين**: تعديل بيانات المدرسين (التخصص، المؤهلات، الخبرة، الصور الشخصية) مع إمكانية حذف الصور.
- **إدارة الدورات الاحترافية**: إضافة، تعديل، حذف الدورات مع رفع الصور، تحديد تاريخ البداية والنهاية، العدد الأقصى للطلاب، وعرض العدد المسجل والمقاعد المتاحة.
- **التحقق من السعة**: منع تسجيل الطلاب في الدورات الممتلئة تلقائياً.
- **إدارة الدروس**: إضافة، تعديل، حذف الدروس، تحديد الدورة والأستاذ، ورفع الملفات. الدروس متاحة فقط للطلاب المسجلين.
- **نظام الدروس للمدرسين**: واجهة خاصة للمدرسين لإدارة دروسهم (تعديل، حذف، تغيير حالة النشر).
- **إدارة الأخبار**: إضافة، تعديل، حذف الأخبار مع رفع الصور.
- **نظام العلامات المتقدم**: 
  - المدرسون: إضافة، تعديل، حذف، وعرض العلامات لطلابهم.
  - المدراء والمعاونون: إدارة كاملة لجميع علامات الطلاب مع إمكانية الإضافة والتعديل والحذف.
- **استمارة اتصل بنا**: مع إرسال تلقائي للتيليجرام.
- **نظام النسخ الاحتياطي**: عرض، تحميل، استعادة النسخ الاحتياطية من لوحة الإدارة.
- **إدارة الرسائل الواردة**: صفحة لعرض رسائل "اتصل بنا"، وتفاصيلها، ووضع علامة كمقروءة، وحذف الرسائل، مع رابط مباشر في لوحة التحكم.
- **إدارة الصور**: إمكانية حذف صور الدورات والمدرسين والطلاب من صفحات التعديل.
- **تحسينات واجهة المستخدم**: سلايدرات Bootstrap Carousel محسّنة للمدرسين والدورات في الصفحة الرئيسية تعرض الصور الفعلية، مع عرض عدد سنوات الخبرة للمدرسين والمقاعد المتاحة للدورات.
- **الأمان**: إزالة البيانات الثابتة، عدم وجود مستخدمين افتراضيين، تحسين أمان مسارات الملفات، فحص صلاحيات دقيق.

### هيكل المشروع
يتكون المشروع من مجلد `app/` الذي يحتوي على النماذج (models)، المسارات (routes) للمصادقة، الإدارة، المدرسين، الطلاب، والصفحات العامة، بالإضافة إلى القوالب (templates)، الملفات الثابتة (static)، والأدوات المساعدة (utils). الملفات الرئيسية تشمل `main.py` و`config.py` وقاعدة البيانات `alqasim_institute.db`.

## Recent Changes
### أكتوبر 22, 2025 - تشغيل تلقائي لبوت التيليجرام وإصلاح الأخطاء
- **Workflow تلقائي للبوت**: تم إضافة Workflow لتشغيل بوت التيليجرام تلقائياً من لوحة الإدارة دون الحاجة لأوامر Terminal
  - البوت يعمل الآن تلقائياً عند تشغيل المشروع
  - لا حاجة لاستخدام Terminal لتشغيل البوت يدوياً
- **إصلاح أخطاء البوت بشكل كامل**:
  - إصلاح جميع أخطاء أسماء الحقول (Course.name → Course.title)
  - إصلاح أخطاء الوصول لاسم المعلم (teacher.full_name → teacher.user.full_name)
  - إصلاح أخطاء الوصول لاسم المستخدم (user.name → user.full_name)
  - إزالة حقول غير موجودة (course.price، teacher.email)
  - البوت يعمل الآن بدون أي أخطاء
- **إصلاح خطأ في الإحصائيات**: إصلاح مشكلة NoneType في دالة update_statistics عند إنشاء سجل إحصائيات جديد

### أكتوبر 22, 2025 - بوت تيليجرام الاحترافي
- **بوت تيليجرام متكامل**: تم برمجة بوت تيليجرام احترافي كامل مع ميزات شاملة
  - نظام تسجيل دخول كامل للطلاب والمعلمين والإدارة
  - عرض الدورات والدروس بشكل تفاعلي
  - الاطلاع على الدرجات والتقييمات
  - قراءة الأخبار والإعلانات
  - التعرف على المعلمين وتخصصاتهم
  - لوحة تحكم مخصصة لكل دور (طالب، معلم، إداري)
  - قوائم تفاعلية سهلة الاستخدام مع inline keyboards
- **صفحة إدارة البوت**: إضافة لوحة تحكم كاملة في قسم الإدارة لإدارة البوت
  - تفعيل/تعطيل البوت
  - تفعيل/تعطيل الإشعارات التلقائية
  - إعدادات Webhook للإنتاج
  - إحصائيات مفصلة (عدد المستخدمين، الرسائل، النشاط)
  - عرض آخر نشاطات المستخدمين
- **نظام الإشعارات التلقائية**: إرسال إشعارات فورية للطلاب عبر التيليجرام
  - إشعار عند إضافة درس جديد
  - إشعار عند إضافة درجة جديدة
  - إشعار عند التسجيل في دورة جديدة
  - إمكانية البث الجماعي للرسائل (broadcast)
- **نماذج بيانات جديدة**:
  - BotSession: لتخزين جلسات المستخدمين في البوت
  - BotStatistics: لتتبع إحصائيات استخدام البوت
  - إضافة حقول جديدة في SiteSettings للتحكم بالبوت
- **تكامل كامل مع الموقع**: أي تحديث على الموقع ينعكس فوراً على البوت

### أكتوبر 2025
- **نظام الصفوف والشعب**: تم إضافة نماذج ClassGrade و Section لتصنيف الطلاب حسب الصفوف والشعب الدراسية مع إمكانية تحديد الحد الأقصى للطلاب في كل شعبة.
- **تحسينات إدارة الدورات**: إضافة حقول تاريخ البداية والنهاية، الحد الأقصى للطلاب، العدد المسجل، والمقاعد المتاحة لكل دورة.
- **التحقق من السعة**: تم إضافة التحقق التلقائي من سعة الدورات ومنع تسجيل الطلاب عندما تكون الدورة ممتلئة.
- **إدارة الصور**: إضافة خيار حذف الصور للدورات والمدرسين والطلاب من صفحات التعديل.
- **تحسين السلايدرات**: عرض الصور الفعلية للمدرسين والدورات في الصفحة الرئيسية مع معلومات إضافية (سنوات الخبرة، المقاعد المتاحة).
- **إضافة رابط الرسائل**: إظهار تبويب إدارة الرسائل في لوحة التحكم الرئيسية للوصول السريع.
- **اختيار الصف والشعبة للطلاب**: إضافة اختيار ديناميكي للصف والشعبة عند تسجيل وتعديل بيانات الطلاب.
- **إصلاح نظام النسخ الاحتياطي**: 
  - إصلاح مشكلة تحميل النسخ الاحتياطية باستخدام os.path.join بدلاً من safe_join مع فحص أمان محسّن.
  - تحسين إرسال النسخ الاحتياطية إلى التيليجرام مع زيادة مهلات الاتصال (timeouts) وفحص حجم الملف (حد أقصى 50 MB).
  - إضافة معلومات حجم الملف في رسالة التيليجرام.
- **إدارة العلامات للمدير والمعاون**: 
  - إضافة صفحة إضافة علامة جديدة للطالب من لوحة الإدارة.
  - إضافة صفحة تعديل علامات الطالب من لوحة الإدارة.
  - إضافة وظيفة حذف علامات الطالب من لوحة الإدارة.
  - تحديث صفحة تفاصيل الطالب لإضافة أزرار إدارة العلامات (إضافة، تعديل، حذف).
- **تحسين استمارة اتصل بنا**: إزالة حقل البريد الإلكتروني وجعل رقم الهاتف هو وسيلة التواصل الأساسية.

## External Dependencies
- **Telegram Bot API**: للتكامل مع Telegram لإرسال إشعارات النسخ الاحتياطي واستلام رسائل "اتصل بنا". يتم إعداد Bot Token و Chat ID من لوحة التحكم الإدارية.