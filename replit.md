# تطبيق معهد القاسم للعلوم واللغات

## Overview
تطبيق ويب شامل لإدارة معهد تعليمي باللغة العربية، مبني باستخدام Flask وPython وقاعدة بيانات SQLite. يوفر نظامًا متكاملًا لإدارة المستخدمين، الدورات التدريبية، الأخبار، والدروس، مع نظام مصادقة متعدد الأدوار (مدير، معاون، مدرس، طالب) ونظام نسخ احتياطي متقدم يدعم التكامل مع Telegram. يهدف المشروع إلى توفير حل شامل لإدارة العمليات التعليمية والإدارية للمعهد، مع التركيز على الأمان وسهولة الاستخدام.

## User Preferences
- جميع الاتصالات باللغة العربية
- شرح واضح ومختصر
- الإبلاغ عن التغييرات المهمة قبل تنفيذها
- إعطاء الأولوية للأمان وسلامة البيانات
- عدم استخدام بيانات ثابتة في الكود

## System Architecture

### التقنيات المستخدمة
-   **الواجهة الخلفية**: Flask (Python 3.11)
-   **قاعدة البيانات**: SQLite
-   **المصادقة**: Flask-Login مع تسجيل دخول برقم الجوال وتشفير كلمات المرور
-   **النماذج**: Flask-WTF مع حماية CSRF
-   **إدارة الملفات**: رفع الصور والملفات بحد أقصى 16 MB
-   **النسخ الاحتياطي**: خيارات متعددة (شامل، بنية، بيانات) مع إرسال تلقائي للتيليجرام، وتوليد نسخ احتياطية تلقائية عند تغيير قاعدة البيانات باستخدام SQLAlchemy Event Listeners ومعالجة خلفية (threading).
-   **التكامل مع التيليجرام**: إدارة كاملة من لوحة التحكم لإشعارات النسخ الاحتياطي واستمارة "اتصل بنا"، بالإضافة إلى بوت تيليجرام تفاعلي للمستخدمين.
-   **التوقيت**: استخدام توقيت دمشق (+3 ساعات).

### الميزات الرئيسية
-   **إدارة المستخدمين والأدوار**: إضافة، تعديل، حذف، تفعيل/تعطيل المستخدمين مع صلاحيات متقدمة لأربعة أدوار.
-   **إدارة الطلاب والأساتذة**: عرض، تعديل، حذف الطلاب والأساتذة، تسجيل الطلاب في دورات، وربطهم بأساتذة، مع تحديد الصف والشعبة لكل طالب. يتضمن نظام بحث وفلترة احترافي (بحث بالاسم/رقم، فلترة حسب الصف/الشعبة/الحالة/التخصص) مع ترقيم الصفحات (15-20 عنصر/صفحة).
-   **إدارة الصفوف والشعب**: نظام متكامل لإدارة الصفوف الدراسية والشعب المرتبطة بها، مع صفحة تفاصيل احترافية لكل شعبة تعرض:
    - قائمة الطلاب المسجلين مع بحث وفلترة متقدمة
    - إحصائيات شاملة (عدد الطلاب، المقاعد المتاحة، متوسط الحضور)
    - إحصائيات مالية (المبالغ المتوقعة، المحصلة، المتبقية) مع شريط تقدم مرئي
-   **إدارة الدورات الاحترافية**: إضافة، تعديل، حذف الدورات مع رفع الصور، تحديد تاريخ البداية والنهاية، العدد الأقصى للطلاب، وعرض العدد المسجل والمقاعد المتاحة.
-   **إدارة الدروس**: إضافة، تعديل، حذف الدروس، تحديد الدورة والأستاذ، ورفع الملفات. الدروس متاحة فقط للطلاب المسجلين، مع واجهة خاصة للمدرسين لإدارة دروسهم.
-   **نظام العلامات المتقدم**: المدرسون يديرون علامات طلابهم، والمدراء والمعاونون لديهم إدارة كاملة لجميع علامات الطلاب.
-   **نظام الأقساط والدفعات المتكامل**: نظام شامل لإدارة الأقساط المالية والدفعات يشمل:
    - إدارة كاملة للأقساط والدفعات من لوحة الإدارة (إضافة، عرض، تعديل، حذف).
    - تتبع حالة كل قسط (مدفوع، جزئي، معلق) مع تحديث تلقائي للحالة.
    - نظام بحث وفلترة متقدم (بحث بالاسم/العنوان، فلترة حسب الحالة/التاريخ، ترتيب حسب التاريخ/المبلغ/الطالب) مع ترقيم الصفحات (20 عنصر/صفحة).
    - صفحة للطالب لعرض أقساطه ودفعاته.
    - تقارير مالية شاملة مع رسوم بيانية (Chart.js) تعرض إحصائيات المبالغ، توزيع الأقساط، إحصائيات الطلاب، الأقساط المتأخرة، طرق الدفع، والتحصيلات اليومية.
    - إشعارات تلقائية عند إضافة قسط جديد أو استلام دفعة.
    - إعدادات تذكير بالأقساط المتأخرة مع جدولة تلقائية يومية.
-   **نظام الإشعارات الاحترافي**: نظام متكامل للإشعارات يدعم:
    - إرسال إشعارات عبر Telegram والموقع معاً (جماعي وفردي ولحسب الدور).
    - إشعارات تلقائية عند إضافة دروس، تحديث علامات، إضافة أقساط، أو استلام دفعات.
    - تتبع حالة القراءة والتسليم لكل إشعار ومصدر القراءة (web/telegram).
    - إحصائيات شاملة (معدل القراءة، التسليم عبر Telegram/الموقع).
    - نظام فلترة متقدم بـ 6 أبعاد (النوع، المستهدف، الحالة، القراءة، التيليجرام، الموقع).
    - عمليات جماعية (حذف أو تعطيل).
    - نافذة منبثقة للإشعارات الجديدة مع فحص دوري كل 30 ثانية.
-   **استمارة اتصل بنا**: مع إرسال تلقائي للتيليجرام.
-   **نظام النسخ الاحتياطي**: عرض، تحميل، استعادة النسخ الاحتياطية من لوحة الإدارة، مع نظام نسخ احتياطي تلقائي ذكي يرسل النسخ إلى تيليجرام.
-   **إدارة الرسائل الواردة**: صفحة لعرض رسائل "اتصل بنا" وإدارتها.
-   **إدارة الصور**: إمكانية حذف صور الدورات والمدرسين والطلاب من صفحات التعديل.
-   **تحسينات واجهة المستخدم**: سلايدرات Bootstrap Carousel محسّنة للمدرسين والدورات في الصفحة الرئيسية.
-   **الأمان**: إزالة البيانات الثابتة، فحص صلاحيات دقيق.
-   **نظام الحضور والغياب الاحترافي**: نظام متكامل لتتبع حضور الطلاب والمدرسين يشمل:
    - تسجيل حضور جماعي بتحديد عدة مستخدمين مرة واحدة مع بحث فوري في الأسماء
    - عرض منظم للسجلات مجمعة حسب التاريخ مع جداول قابلة للتوسيع لكل تاريخ
    - فلترة متقدمة (حسب نوع المستخدم، الحالة، نطاق التاريخ)
    - إحصائيات تفصيلية لكل تاريخ (إجمالي السجلات، الحضور، الغياب)
-   **بوت تيليجرام متكامل**: بوت احترافي للمستخدمين يوفر تسجيل دخول، عرض دورات ودروس ودرجات وأخبار، مع لوحة تحكم مخصصة لكل دور وإشعارات تلقائية. يتم تشغيله تلقائيًا من لوحة الإدارة.

## Recent Changes (October 26, 2025)
-   **تحسينات نظام البحث والفلترة**: إضافة بحث وفلترة احترافية في صفحات إدارة المدرسين، الطلاب، والأقساط مع ترقيم الصفحات
-   **تحسين نظام الحضور**: إضافة تسجيل حضور جماعي مع بحث فوري، وعرض منظم للسجلات حسب التاريخ
-   **صفحة تفاصيل الشعبة**: إضافة صفحة شاملة لكل شعبة تعرض الطلاب والإحصائيات المالية ومعدل الحضور
-   **إصلاح أخطاء**: إصلاح مشكلة استخدام Lesson.created_at وتصحيح استخدام func.case في SQLAlchemy

### هيكل المشروع
يتكون المشروع من مجلد `app/` الذي يحتوي على النماذج (models)، المسارات (routes) للمصادقة، الإدارة، المدرسين، الطلاب، والصفحات العامة، بالإضافة إلى القوالب (templates)، الملفات الثابتة (static)، والأدوات المساعدة (utils). الملفات الرئيسية تشمل `main.py` و`config.py` وقاعدة البيانات `alqasim_institute.db`.

## External Dependencies
-   **Telegram Bot API**: للتكامل مع Telegram لإرسال إشعارات النسخ الاحتياطي التلقائية، استلام رسائل "اتصل بنا"، وتشغيل بوت التيليجرام التفاعلي للمستخدمين. يتم إعداد Bot Token و Chat ID من لوحة التحكم الإدارية.