{% extends "base.html" %}

{% block title %}ุชุตููุฑ ุงูุจูุงูุงุช - ูุนูุฏ ุงููุงุณู{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">
        <i class="fas fa-trash-restore ms-2"></i>
        ุชุตููุฑ ุงูุจูุงูุงุช
    </h2>

    <div class="alert alert-danger border-danger shadow-sm">
        <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle fa-3x ms-3"></i>
            <div>
                <h4 class="alert-heading mb-2">โ๏ธ ุชุญุฐูุฑ ุดุฏูุฏ ุงูุฃูููุฉ!</h4>
                <p class="mb-2">ูุฐู ุงูุตูุญุฉ ุชุชูุญ ูู <strong>ุญุฐู ุงูุจูุงูุงุช ุจุดูู ุฏุงุฆู</strong> ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</p>
                <ul class="mb-0">
                    <li>ุงูุนูููุฉ <strong class="text-decoration-underline">ุบูุฑ ูุงุจูุฉ ููุชุฑุงุฌุน</strong></li>
                    <li>ูููุตุญ ุจุดุฏุฉ ุจุฅูุดุงุก <a href="{{ url_for('admin.backup') }}" class="alert-link">ูุณุฎุฉ ุงุญุชูุงุทูุฉ</a> ูุจู ุงููุชุงุจุนุฉ</li>
                    <li>ุงุณุชุฎุฏู ูุฐู ุงูููุฒุฉ ุจุญุฐุฑ ุดุฏูุฏ</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0">
                <i class="fas fa-cog ms-2"></i>
                ุฎูุงุฑุงุช ุงูุชุตููุฑ
            </h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('admin.data_reset') }}" id="resetForm">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6 class="mb-3 text-primary">
                            <i class="fas fa-check-square ms-2"></i>
                            ุงุฎุชุฑ ุงูุจูุงูุงุช ุงููุฑุงุฏ ุญุฐููุง:
                        </h6>
                        
                        <div class="form-check mb-3 p-3 bg-light rounded">
                            <input class="form-check-input" type="checkbox" name="reset_all" id="reset_all">
                            <label class="form-check-label fw-bold text-danger" for="reset_all">
                                <i class="fas fa-exclamation-circle ms-2"></i>
                                ุญุฐู ุดุงูู ูุฌููุน ุงูุจูุงูุงุช
                            </label>
                            <small class="d-block text-muted mt-1">ุณูุชู ุญุฐู ูู ุงูุจูุงูุงุช ุฃุฏูุงู ุฏูุนุฉ ูุงุญุฏุฉ</small>
                        </div>

                        <hr>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_students" id="reset_students">
                            <label class="form-check-label" for="reset_students">
                                <i class="fas fa-user-graduate ms-2"></i>
                                ุญุฐู ุณุฌูุงุช ุงูุทูุงุจ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_teachers" id="reset_teachers">
                            <label class="form-check-label" for="reset_teachers">
                                <i class="fas fa-chalkboard-teacher ms-2"></i>
                                ุญุฐู ุณุฌูุงุช ุงูุฃุณุงุชุฐุฉ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_courses" id="reset_courses">
                            <label class="form-check-label" for="reset_courses">
                                <i class="fas fa-book ms-2"></i>
                                ุญุฐู ุงูุฏูุฑุงุช
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_lessons" id="reset_lessons">
                            <label class="form-check-label" for="reset_lessons">
                                <i class="fas fa-file-alt ms-2"></i>
                                ุญุฐู ุงูุฏุฑูุณ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_grades" id="reset_grades">
                            <label class="form-check-label" for="reset_grades">
                                <i class="fas fa-chart-line ms-2"></i>
                                ุญุฐู ุงูุนูุงูุงุช
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_payments" id="reset_payments">
                            <label class="form-check-label" for="reset_payments">
                                <i class="fas fa-money-bill-wave ms-2"></i>
                                ุญุฐู ุงูุฃูุณุงุท ูุงูุฏูุนุงุช
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_enrollments" id="reset_enrollments">
                            <label class="form-check-label" for="reset_enrollments">
                                <i class="fas fa-user-check ms-2"></i>
                                ุญุฐู ุงูุชุณุฌููุงุช
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_grades_data" id="reset_grades_data">
                            <label class="form-check-label" for="reset_grades_data">
                                <i class="fas fa-graduation-cap ms-2"></i>
                                ุญุฐู ุงูุตููู ุงูุฏุฑุงุณูุฉ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_sections" id="reset_sections">
                            <label class="form-check-label" for="reset_sections">
                                <i class="fas fa-layer-group ms-2"></i>
                                ุญุฐู ุงูุดุนุจ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_news" id="reset_news">
                            <label class="form-check-label" for="reset_news">
                                <i class="fas fa-newspaper ms-2"></i>
                                ุญุฐู ุงูุฃุฎุจุงุฑ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_notifications" id="reset_notifications">
                            <label class="form-check-label" for="reset_notifications">
                                <i class="fas fa-bell ms-2"></i>
                                ุญุฐู ุงูุฅุดุนุงุฑุงุช
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_attendance" id="reset_attendance">
                            <label class="form-check-label" for="reset_attendance">
                                <i class="fas fa-clipboard-check ms-2"></i>
                                ุญุฐู ุณุฌูุงุช ุงูุญุถูุฑ ูุงูุบูุงุจ
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input reset-option" type="checkbox" name="reset_contacts" id="reset_contacts">
                            <label class="form-check-label" for="reset_contacts">
                                <i class="fas fa-envelope ms-2"></i>
                                ุญุฐู ุฑุณุงุฆู ุงุชุตู ุจูุง
                            </label>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card bg-light border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle ms-2"></i>
                                    ูุนูููุงุช ูููุฉ
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6 class="text-primary">๐ ูุจู ุงูุจุฏุก:</h6>
                                <ul class="small mb-3">
                                    <li>ุชุฃูุฏ ูู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ</li>
                                    <li>ุชุญูู ูู ุงุฎุชูุงุฑุงุชู ุจุนูุงูุฉ</li>
                                    <li>ูุง ูููู ุงูุชุฑุงุฌุน ุนู ุงูุญุฐู</li>
                                </ul>

                                <h6 class="text-danger">โ๏ธ ุงูุญุฐู ุงูุดุงูู:</h6>
                                <ul class="small mb-3">
                                    <li>ูุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุญุฏุฏุฉ ุฃุฏูุงู</li>
                                    <li>ุงุณุชุฎุฏูู ููุท ุนูุฏ ุงูุถุฑูุฑุฉ ุงููุตูู</li>
                                    <li>ุณูุชุทูุจ ุชุฃููุฏ ูุฒุฏูุฌ</li>
                                </ul>

                                <h6 class="text-success">โ ูุง ูู ูุชู ุญุฐูู:</h6>
                                <ul class="small mb-0">
                                    <li>ุญุณุงุจุงุช ุงููุฏูุฑูู ูุงููุนุงูููู</li>
                                    <li>ุฅุนุฏุงุฏุงุช ุงููุธุงู</li>
                                    <li>ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุณุงุจูุฉ</li>
                                </ul>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <h6><i class="fas fa-lightbulb ms-2"></i> ูุตูุญุฉ:</h6>
                            <p class="mb-0 small">ููููู ุงุฎุชูุงุฑ ุนุฏุฉ ุฎูุงุฑุงุช ูู ููุณ ุงูููุช. ุณูุชู ุญุฐู ุงูุจูุงูุงุช ุจุงูุชุฑุชูุจ ุงูุตุญูุญ ูุชุฌูุจ ูุดุงูู ุงูุงุฑุชุจุงุทุงุช.</p>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-right ms-2"></i>
                        ุฅูุบุงุก ูุงูุนูุฏุฉ
                    </a>
                    <button type="submit" class="btn btn-danger btn-lg" id="submitBtn">
                        <i class="fas fa-trash-alt ms-2"></i>
                        ุชูููุฐ ุนูููุฉ ุงูุญุฐู
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Script for "ุญุฐู ุดุงูู" checkbox
document.getElementById('reset_all').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.reset-option');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
});

// Uncheck "ุญุฐู ุดุงูู" if any individual option is unchecked
document.querySelectorAll('.reset-option').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const allChecked = Array.from(document.querySelectorAll('.reset-option')).every(cb => cb.checked);
        document.getElementById('reset_all').checked = allChecked;
    });
});

// Form submission confirmation
document.getElementById('resetForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
    
    if (checkedBoxes.length === 0) {
        alert('โ๏ธ ูุฑุฌู ุงุฎุชูุงุฑ ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู ููุญุฐู');
        return false;
    }
    
    const resetAll = document.getElementById('reset_all').checked;
    let confirmMessage = '';
    
    if (resetAll) {
        confirmMessage = '๐ด ุชุญุฐูุฑ: ุฃูุช ุนูู ูุดู ุญุฐู ุฌููุน ุงูุจูุงูุงุช!\n\n';
        confirmMessage += 'ูุฐู ุงูุนูููุฉ ุณุชุญุฐู ูู ุดูุก ููุง ูููู ุงูุชุฑุงุฌุน ุนููุง.\n\n';
        confirmMessage += 'ูู ุฃูุช ูุชุฃูุฏ ุชูุงูุงู ูู ุงููุชุงุจุนุฉุ';
        
        if (!confirm(confirmMessage)) {
            return false;
        }
        
        // Double confirmation for complete reset
        const doubleConfirm = prompt('ููุชุฃููุฏุ ูุฑุฌู ูุชุงุจุฉ "ุญุฐู" ูู ุงููุฑุจุน ุฃุฏูุงู:');
        if (doubleConfirm !== 'ุญุฐู') {
            alert('ุชู ุฅูุบุงุก ุงูุนูููุฉ');
            return false;
        }
    } else {
        const selectedItems = [];
        checkedBoxes.forEach(box => {
            const label = document.querySelector(`label[for="${box.id}"]`);
            if (label && box.id !== 'reset_all') {
                selectedItems.push(label.textContent.trim());
            }
        });
        
        confirmMessage = 'โ๏ธ ุฃูุช ุนูู ูุดู ุญุฐู ุงูุจูุงูุงุช ุงูุชุงููุฉ:\n\n';
        confirmMessage += selectedItems.join('\n');
        confirmMessage += '\n\nูุฐู ุงูุนูููุฉ ูุง ูููู ุงูุชุฑุงุฌุน ุนููุง.\n\n';
        confirmMessage += 'ูู ุฃูุช ูุชุฃูุฏ ูู ุงููุชุงุจุนุฉุ';
        
        if (!confirm(confirmMessage)) {
            return false;
        }
    }
    
    this.submit();
});
</script>

<style>
.form-check-input:checked {
    background-color: #dc3545;
    border-color: #dc3545;
}

.form-check-label {
    cursor: pointer;
    user-select: none;
}

.form-check:hover {
    background-color: #f8f9fa;
    border-radius: 5px;
    transition: background-color 0.2s;
}

#reset_all:checked ~ label {
    color: #dc3545;
    font-weight: bold;
}
</style>
{% endblock %}
